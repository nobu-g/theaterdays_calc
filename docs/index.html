<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=10.0, user-scalable=yes">
    <title>ミリシタスコア計算機</title>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" type="text/css" href="style.css">

</head>

<body>
    <h1>
        ミリシタスコア計算機
    </h1>
    <h5>
        全てPerfectだった時のスコアをシミュレートします。
    </h5>
    <form id="form">
        <div id="skill">
            <div id="skill1">
                <p>
                    スキル1:<br>
                    <input name="interval" required="required" min="0" type="number">秒ごとに
                    <input name="probability" required="required" min="0" max="100" type="number">%の確率で
                    <input name="duration" required="required" min="0" type="number">秒間、<br>
                    <select name="target" required="required">
                        <option></option>
                        <option value="score1">Perfect/Greatのスコア</option>
                        <option value="score2">Perfectのスコア</option>
                        <option value="combo">コンボボーナス</option>
                        <option value="other">その他</option>
                    </select>が
                    <input name="rate" required="required" min="0" max="100" type="number">%アップ
                </p>
            </div>
            <div id="skill2">
                <p>
                    スキル2:<br>
                    <input name="interval" required="required" min="0" type="number">秒ごとに
                    <input name="probability" required="required" min="0" max="100" type="number">%の確率で
                    <input name="duration" required="required" min="0" type="number">秒間、<br>
                    <select name="target">
                        <option></option>
                        <option value="score1">Perfect/Greatのスコア</option>
                        <option value="score2">Perfectのスコア</option>
                        <option value="combo">コンボボーナス</option>
                        <option value="other">その他</option>
                    </select>が
                    <input name="rate" required="required" min="0" max="100" type="number">%アップ
                </p>
            </div>

            <div id="skill3">
                <p>
                    スキル3:<br>
                    <input name="interval" required="required" min="0" type="number">秒ごとに
                    <input name="probability" required="required" min="0" max="100" type="number">%の確率で
                    <input name="duration" required="required" min="0" type="number">秒間、<br>
                    <select name="target">
                        <option></option>
                        <option value="score1">Perfect/Greatのスコア</option>
                        <option value="score2">Perfectのスコア</option>
                        <option value="combo">コンボボーナス</option>
                        <option value="other">その他</option>
                    </select>が
                    <input name="rate" required="required" min="0" max="100" type="number">%アップ
                </p>
            </div>
            <div id="skill4">
                <p>
                    スキル4:<br>
                    <input name="interval" required="required" min="0" type="number">秒ごとに
                    <input name="probability" required="required" min="0" max="100" type="number">%の確率で
                    <input name="duration" required="required" min="0" type="number">秒間、<br>
                    <select name="target">
                        <option></option>
                        <option value="score1">Perfect/Greatのスコア</option>
                        <option value="score2">Perfectのスコア</option>
                        <option value="combo">コンボボーナス</option>
                        <option value="other">その他</option>
                </select>が
                    <input name="rate" required="required" min="0" max="100" type="number">%アップ
                </p>
            </div>
            <div id="skill5">
                <p>
                    スキル5:<br>
                    <input name="interval" required="required" min="0" type="number">秒ごとに
                    <input name="probability" required="required" min="0" max="100" type="number">%の確率で
                    <input name="duration" required="required" min="0" type="number">秒間、<br>
                    <select name="target">
                        <option></option>
                        <option value="score1">Perfect/Greatのスコア</option>
                        <option value="score2">Perfectのスコア</option>
                        <option value="combo">コンボボーナス</option>
                        <option value="other">その他</option>
                    </select>が
                    <input name="rate" required="required" min="0" max="100" type="number">%アップ
                </p>
            </div>
        </div>

        <div id="music">
            <p>
                楽曲:<br>
                <select name="music">
                    <option value="">楽曲選択</option>
                    <option value="自分REST@RT">自分REST@RT</option>
                    <option value="Brand New Theater!">Brand New Theater!</option>
                    <option value="Welcome!!">Welcome!!</option>
                </select>
            </p>
        </div>

        <div id="appeal">
            <p>
                合計アピール:<br>
                <input name="appeal" required="required" min="0" type="number"><br>
                <font size="-3">※ライブ開始直前の画面を参照。楽曲によって変わります。</font>
            </p>
        </div>

        <div class="button">
            <input type="submit" id="submitBtn" value="計算" onClick="load()">
        </div>


        <div id="result">
            <p>
                <label for="ave">平均スコア:</label>
                <span id="ave"></span>
            </p>
            <p>
                <label for="std_dev">標準偏差:</label>
                <span id="std_dev"></span>
            </p>
            <p>
                <label for="target_score">目標スコア:</label>
                <input type="text" id="target_score" onchange="repeatedTryals()" />
            </p>
            <p>
                <label for="trials">試行回数:</label>
                <select name="trials" id="trials" onchange="repeatedTryals()">
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                    <option value="8">8</option>
                    <option value="9">9</option>
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="30">30</option>
                    <option value="40">40</option>
                    <option value="50">50</option>
                    <option value="60">60</option>
                    <option value="70">70</option>
                    <option value="80">80</option>
                    <option value="90">90</option>
                    <option value="100">100</option>
                </select>
            </p>
        </div>
    </form>



<script type="text/javascript" src="jquery-3.3.1.min.js"></script>  <!-- 最初に読み込む -->
<script type="text/javascript" src="parse.js"></script>
<script type="text/javascript" src="config.js"></script>
<script type="text/javascript" src="calc.js"></script>
<script type="text/javascript" src="load_file.js"></script>
<script>


// ページ読み込み時に保存されていたデータを展開
$(document).ready(function(){
    setConfig();
    $('#result').hide();    // 結果は計算するまで隠しておく
});

// フォーム入力の内容に誤りがないか調べる
function formCheck() {
    for (const element of document.getElementsByTagName('form')[0]) {
        if (element.validity.valid == false) { return false; }
    }
    return true;
}

// 譜面データをロード
function load() {
    storeConfig();    // 入力データを保存

    // エラーチェック
    if (formCheck() == false) { return; }

    const musicName = $('#music select option:selected').val()
    loadTextFile('https://nobu-g.github.io/theaterdays_calc/bms/' + musicName + '.bms');
}


$('#submitBtn').click(function(e) {
    if (formCheck()){
        return e.preventDefault();
    }
});

</script>

</body>
</html>
